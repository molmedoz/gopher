# Package Distribution & Automation Guide

**Complete guide to publishing Gopher to Homebrew, Chocolatey, and Linux package managers with automated releases**

---

## üìã **Table of Contents**

- [Overview](#overview)
- [GoReleaser Setup](#goreleaser-setup)
- [Homebrew Distribution](#homebrew-distribution)
- [Chocolatey Distribution](#chocolatey-distribution)
- [Linux Package Managers](#linux-package-managers)
- [GitHub Actions Automation](#github-actions-automation)
- [Release Workflow](#release-workflow)
- [Best Practices](#best-practices)

---

## üéØ **Overview**

### **What We'll Set Up:**

| Platform | Package Manager | Automation |
|----------|----------------|------------|
| **macOS/Linux** | Homebrew | ‚úÖ Automated via GoReleaser |
| **Windows** | Chocolatey | ‚úÖ Automated via GoReleaser |
| **Linux** | Snap | ‚úÖ Automated via GoReleaser |
| **Linux** | APT (Debian/Ubuntu) | ‚úÖ Via custom repository |
| **Linux** | RPM (Fedora/RHEL) | ‚úÖ Via custom repository |
| **All** | GitHub Releases | ‚úÖ Automated via GoReleaser |

### **The Magic Tool: GoReleaser**

**GoReleaser** automates everything:
- ‚úÖ Builds binaries for multiple platforms
- ‚úÖ Creates GitHub releases
- ‚úÖ Updates Homebrew taps
- ‚úÖ Publishes to Chocolatey
- ‚úÖ Generates checksums
- ‚úÖ Creates release notes
- ‚úÖ Signs binaries (optional)

**One command releases everywhere!**

---

## üöÄ **GoReleaser Setup**

### **Step 1: Install GoReleaser**

```bash
# macOS
brew install goreleaser/tap/goreleaser

# Linux
# Add GoReleaser's tap
brew install goreleaser/tap/goreleaser

# Or use script
curl -sfL https://goreleaser.com/static/run | bash
```

### **Step 2: Initialize GoReleaser**

```bash
cd /path/to/gopher
goreleaser init
```

This creates `.goreleaser.yml` (I'll provide a complete config below)

### **Step 3: Test Locally**

```bash
# Build snapshot (doesn't publish)
goreleaser release --snapshot --clean

# Check what would be released
goreleaser check
```

---

## üç∫ **Homebrew Distribution**

### **Overview:**

Homebrew is the primary package manager for macOS and popular on Linux.

**Two approaches:**
1. **Official Homebrew** - Submit to homebrew-core (requires popularity)
2. **Custom Tap** - Create your own tap (recommended to start)

### **Approach 1: Custom Tap (Recommended)**

#### **Create Homebrew Tap Repository:**

1. **Create a new GitHub repository:**
   - Name: `homebrew-tap` (GitHub username: `molmedoz`)
   - Full name: `molmedoz/homebrew-tap`
   - Public repository
   - Initialize with README

2. **Repository structure:**
   ```
   homebrew-tap/
   ‚îú‚îÄ‚îÄ README.md
   ‚îî‚îÄ‚îÄ Formula/
       ‚îî‚îÄ‚îÄ gopher.rb  # Will be auto-generated by GoReleaser
   ```

3. **Users will install with:**
   ```bash
   brew install molmedoz/tap/gopher
   ```

#### **GoReleaser will automatically:**
- Generate the formula
- Calculate checksums
- Update the tap repository
- Handle version updates

### **Approach 2: Official Homebrew (Later)**

Once Gopher gains popularity:

1. **Requirements:**
   - 30+ stars on GitHub
   - 75+ forks (combined with watchers)
   - Notable project
   - Stable versions

2. **Submit PR to:**
   - Repository: `Homebrew/homebrew-core`
   - File: `Formula/gopher.rb`

---

## üç´ **Chocolatey Distribution**

### **Overview:**

Chocolatey is the main package manager for Windows.

### **Setup Steps:**

#### **1. Create Chocolatey Account**

- Visit: https://community.chocolatey.org/
- Register account
- Get API key from account settings

#### **2. Reserve Package Name**

```bash
# Install Chocolatey CLI
# (Run in PowerShell as Administrator on Windows)
Set-ExecutionPolicy Bypass -Scope Process -Force
[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

# Reserve package name
choco new gopher
```

#### **3. GoReleaser will handle:**
- Creating `.nupkg` file
- Uploading to Chocolatey
- Updating package on each release

#### **4. Users will install with:**
```powershell
choco install gopher
```

---

## üêß **Linux Package Managers**

### **Option 1: Snap (Easiest)**

**Snap** works across all major Linux distributions.

#### **Setup:**

1. **Create Snapcraft account:**
   - Visit: https://snapcraft.io/
   - Register with Ubuntu One account

2. **GoReleaser handles snap creation**

3. **Users install with:**
   ```bash
   sudo snap install gopher
   ```

### **Option 2: Custom APT Repository (Debian/Ubuntu)**

#### **Setup:**

1. **Create package repository:**
   - Host on GitHub Pages or separate server
   - Structure for APT packages

2. **GoReleaser creates .deb packages**

3. **Users add repository:**
   ```bash
   # Add repository
   echo "deb [trusted=yes] https://molmedoz.github.io/gopher-apt /" | sudo tee /etc/apt/sources.list.d/gopher.list
   
   # Update and install
   sudo apt update
   sudo apt install gopher
   ```

### **Option 3: Custom RPM Repository (Fedora/RHEL)**

#### **Setup:**

1. **Create RPM repository:**
   - Host on GitHub Pages or separate server
   - Structure for RPM packages

2. **GoReleaser creates .rpm packages**

3. **Users add repository:**
   ```bash
   # Add repository
   sudo tee /etc/yum.repos.d/gopher.repo <<EOF
   [gopher]
   name=Gopher Repository
   baseurl=https://molmedoz.github.io/gopher-rpm
   enabled=1
   gpgcheck=0
   EOF
   
   # Install
   sudo dnf install gopher
   # or
   sudo yum install gopher
   ```

### **Option 4: AUR (Arch Linux)**

For Arch Linux users via AUR (Arch User Repository):

1. **Create PKGBUILD:**
   - Submit to AUR
   - Community maintains

2. **Users install with:**
   ```bash
   yay -S gopher
   # or
   paru -S gopher
   ```

---

## ‚öôÔ∏è **Complete GoReleaser Configuration**

Create `.goreleaser.yml` in your repository root:

```yaml
# GoReleaser configuration for Gopher
# Documentation: https://goreleaser.com

version: 2

# Project metadata
project_name: gopher

# Build configuration
builds:
  - id: gopher
    main: ./cmd/gopher
    binary: gopher
    
    # Build for multiple platforms
    goos:
      - linux
      - darwin
      - windows
    
    goarch:
      - amd64
      - arm64
      - arm
    
    goarm:
      - "6"
      - "7"
    
    # Ignore combinations that don't make sense
    ignore:
      - goos: windows
        goarch: arm
      - goos: windows
        goarch: arm64
    
    # Build flags
    flags:
      - -trimpath
    
    ldflags:
      - -s -w
      - -X main.version={{.Version}}
      - -X main.commit={{.Commit}}
      - -X main.date={{.Date}}
      - -X main.builtBy=goreleaser
    
    env:
      - CGO_ENABLED=0

# Archive customization
archives:
  - id: gopher
    format: tar.gz
    
    # Use zip for Windows
    format_overrides:
      - goos: windows
        format: zip
    
    # Archive name template
    name_template: >-
      {{ .ProjectName }}_
      {{- .Version }}_
      {{- title .Os }}_
      {{- if eq .Arch "amd64" }}x86_64
      {{- else if eq .Arch "386" }}i386
      {{- else }}{{ .Arch }}{{ end }}
      {{- if .Arm }}v{{ .Arm }}{{ end }}
    
    # Files to include
    files:
      - LICENSE
      - README.md
      - CHANGELOG.md
      - QUICK_REFERENCE.md

# Checksums
checksum:
  name_template: 'checksums.txt'
  algorithm: sha256

# Snapshots (for testing)
snapshot:
  name_template: "{{ incpatch .Version }}-next"

# Changelog
changelog:
  sort: asc
  use: github
  filters:
    exclude:
      - '^docs:'
      - '^test:'
      - '^ci:'
      - '^chore:'
      - '^style:'
  groups:
    - title: 'New Features'
      regexp: '^.*?feat(\([[:word:]]+\))??!?:.+$'
      order: 0
    - title: 'Bug Fixes'
      regexp: '^.*?fix(\([[:word:]]+\))??!?:.+$'
      order: 1
    - title: 'Performance Improvements'
      regexp: '^.*?perf(\([[:word:]]+\))??!?:.+$'
      order: 2
    - title: 'Documentation'
      regexp: '^.*?docs(\([[:word:]]+\))??!?:.+$'
      order: 3
    - title: 'Other Changes'
      order: 999

# GitHub Release
release:
  github:
    owner: molmedoz
    name: gopher
  
  # Release name
  name_template: "Gopher {{.Version}}"
  
  # Draft release (set to false for auto-publish)
  draft: false
  
  # Prerelease detection
  prerelease: auto
  
  # Release header
  header: |
    ## Gopher {{.Version}} Release
    
    **Install or upgrade:**
    
    ```bash
    # macOS/Linux (Homebrew)
    brew upgrade gopher
    
    # Windows (Chocolatey)
    choco upgrade gopher
    
    # Linux (Snap)
    sudo snap refresh gopher
    
    # Direct download
    # See assets below
    ```
  
  # Release footer
  footer: |
    ---
    
    **Full Changelog**: https://github.com/molmedoz/gopher/compare/{{ .PreviousTag }}...{{ .Tag }}
    
    **Documentation**: https://molmedoz.github.io/gopher/
    
    **Support**: If you find Gopher useful, consider [sponsoring its development](https://github.com/sponsors/molmedoz)!

# Homebrew Tap
brews:
  - name: gopher
    
    # GitHub repository for tap
    repository:
      owner: molmedoz
      name: homebrew-tap
      token: "{{ .Env.HOMEBREW_TAP_GITHUB_TOKEN }}"
    
    # Git author
    commit_author:
      name: goreleaserbot
      email: bot@goreleaser.com
    
    # Commit message
    commit_msg_template: "Brew formula update for {{ .ProjectName }} version {{ .Tag }}"
    
    # Folder inside the tap
    folder: Formula
    
    # Homepage
    homepage: "https://github.com/molmedoz/gopher"
    
    # Description
    description: "A simple, fast, and dependency-free Go version manager"
    
    # License
    license: "MIT"
    
    # Skip upload if draft
    skip_upload: false
    
    # Dependencies (if any)
    # dependencies:
    #   - name: git
    
    # Install script
    install: |
      bin.install "gopher"
    
    # Test script
    test: |
      system "#{bin}/gopher", "version"

# Chocolatey
chocolateys:
  - name: gopher
    
    # Package owners
    owners: molmedoz
    
    # Title
    title: Gopher
    
    # Authors
    authors: molmedoz
    
    # Project URL
    project_url: https://github.com/molmedoz/gopher
    
    # Icon URL
    icon_url: 'https://raw.githubusercontent.com/molmedoz/gopher/main/build/appicon.png'
    
    # License URL
    license_url: https://github.com/molmedoz/gopher/blob/main/LICENSE
    
    # Documentation
    docs_url: https://molmedoz.github.io/gopher/
    
    # Bug tracker
    bug_tracker_url: https://github.com/molmedoz/gopher/issues
    
    # Tags
    tags: "go golang version-manager cli developer-tools"
    
    # Summary
    summary: A simple, fast, and dependency-free Go version manager
    
    # Description
    description: |
      Gopher is a cross-platform Go version manager that enables you to:
      - Install and manage multiple Go versions
      - Switch between versions instantly
      - Manage system and custom Go installations
      - Work on different projects with different Go versions
    
    # Release notes
    release_notes: "https://github.com/molmedoz/gopher/releases/tag/v{{ .Version }}"
    
    # API key from environment
    api_key: "{{ .Env.CHOCOLATEY_API_KEY }}"
    
    # Source repository
    source_repo: "https://push.chocolatey.org/"
    
    # Skip publish
    skip_publish: false

# Snapcraft
snapcrafts:
  - name: gopher
    
    # Summary (max 79 chars)
    summary: A simple, fast, and dependency-free Go version manager
    
    # Description
    description: |
      Gopher is a cross-platform Go version manager that enables you to:
      * Install and manage multiple Go versions
      * Switch between versions instantly  
      * Manage system and custom Go installations
      * Work on different projects with different Go versions
    
    # Grade (stable or devel)
    grade: stable
    
    # Confinement (strict, devmode, or classic)
    confinement: classic
    
    # License
    license: MIT
    
    # Base
    base: core22
    
    # Apps
    apps:
      gopher:
        command: gopher

# Linux packages
nfpms:
  - id: gopher
    
    # Package name
    package_name: gopher
    
    # Vendor
    vendor: molmedoz
    
    # Homepage
    homepage: https://github.com/molmedoz/gopher
    
    # Maintainer
    maintainer: molmedoz <your-email@example.com>
    
    # Description
    description: A simple, fast, and dependency-free Go version manager
    
    # License
    license: MIT
    
    # Formats
    formats:
      - deb
      - rpm
      - apk
    
    # Dependencies (if any)
    # dependencies:
    #   - git
    
    # Recommended packages
    # recommends:
    #   - git
    
    # Binaries
    binaries:
      gopher: /usr/local/bin/gopher
    
    # Files to include
    contents:
      - src: ./LICENSE
        dst: /usr/share/doc/gopher/LICENSE
      - src: ./README.md
        dst: /usr/share/doc/gopher/README.md

# Docker images (optional)
dockers:
  - image_templates:
      - "ghcr.io/molmedoz/gopher:{{ .Version }}"
      - "ghcr.io/molmedoz/gopher:latest"
    
    dockerfile: Dockerfile
    
    build_flag_templates:
      - "--pull"
      - "--label=org.opencontainers.image.created={{.Date}}"
      - "--label=org.opencontainers.image.title={{.ProjectName}}"
      - "--label=org.opencontainers.image.revision={{.FullCommit}}"
      - "--label=org.opencontainers.image.version={{.Version}}"
      - "--platform=linux/amd64"

# Announce (optional - notify on release)
announces:
  - provider: twitter
    enabled: false
    message_template: 'Gopher {{ .Tag }} is out! Check it out: {{ .ReleaseURL }}'
```

---

## ü§ñ **GitHub Actions Automation**

Create `.github/workflows/release.yml`:

```yaml
name: Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write
  packages: write

jobs:
  goreleaser:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'

      - name: Run GoReleaser
        uses: goreleaser/goreleaser-action@v6
        with:
          distribution: goreleaser
          version: latest
          args: release --clean
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          HOMEBREW_TAP_GITHUB_TOKEN: ${{ secrets.HOMEBREW_TAP_TOKEN }}
          CHOCOLATEY_API_KEY: ${{ secrets.CHOCOLATEY_API_KEY }}
          SNAPCRAFT_STORE_CREDENTIALS: ${{ secrets.SNAPCRAFT_TOKEN }}
```

---

## üîê **Setting Up Secrets**

### **GitHub Secrets to Add:**

Go to: Repository ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions

#### **1. HOMEBREW_TAP_TOKEN**

```bash
# Create GitHub Personal Access Token
# Go to: GitHub Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic)
# Click: Generate new token (classic)
# Scopes needed: repo (all)
# Copy token and add as secret: HOMEBREW_TAP_TOKEN
```

#### **2. CHOCOLATEY_API_KEY**

```bash
# Get from: https://community.chocolatey.org/account
# Go to API Keys section
# Copy key and add as secret: CHOCOLATEY_API_KEY
```

#### **3. SNAPCRAFT_TOKEN**

```bash
# Install snapcraft
sudo snap install snapcraft --classic

# Login
snapcraft login

# Export credentials
snapcraft export-login snapcraft-credentials

# Copy file contents and add as secret: SNAPCRAFT_TOKEN
```

---

## üì¶ **Release Workflow**

### **Complete Release Process:**

#### **Step 1: Prepare Release**

```bash
# Make sure everything is committed
git status

# Run tests
make test

# Update CHANGELOG.md with new version changes
vim CHANGELOG.md
git add CHANGELOG.md
git commit -m "docs: update changelog for v1.0.0"
```

#### **Step 2: Create and Push Tag**

```bash
# Create annotated tag
git tag -a v1.0.0 -m "Release v1.0.0"

# Push tag to GitHub
git push origin v1.0.0
```

#### **Step 3: GitHub Actions Takes Over**

GitHub Actions will automatically:
1. ‚úÖ Build binaries for all platforms
2. ‚úÖ Create GitHub Release
3. ‚úÖ Upload release assets
4. ‚úÖ Update Homebrew tap
5. ‚úÖ Publish to Chocolatey
6. ‚úÖ Publish Snap package
7. ‚úÖ Create .deb and .rpm packages
8. ‚úÖ Generate checksums
9. ‚úÖ Create release notes

#### **Step 4: Verify Release**

```bash
# Check GitHub Release
# Visit: https://github.com/molmedoz/gopher/releases

# Test Homebrew (after a few minutes)
brew upgrade gopher

# Test Chocolatey (after approval, can take hours)
choco upgrade gopher

# Test Snap
sudo snap refresh gopher
```

---

## üéØ **Best Practices**

### **Versioning:**

Use **Semantic Versioning** (semver):
- `v1.0.0` - Major release (breaking changes)
- `v1.1.0` - Minor release (new features, backward compatible)
- `v1.1.1` - Patch release (bug fixes)

### **Pre-releases:**

```bash
# Beta release
git tag -a v1.0.0-beta.1 -m "Beta release"

# Release candidate
git tag -a v1.0.0-rc.1 -m "Release candidate"
```

### **Testing Before Release:**

```bash
# Test GoReleaser locally (doesn't publish)
goreleaser release --snapshot --clean

# Check generated files
ls dist/
```

### **Release Checklist:**

- [ ] All tests passing
- [ ] CHANGELOG.md updated
- [ ] Version bumped in code (if applicable)
- [ ] Documentation updated
- [ ] No uncommitted changes
- [ ] Tag follows semver
- [ ] Release notes prepared

---

## üöÄ **Installation Commands for Users**

After setup, users can install Gopher using:

### **macOS:**
```bash
# Using Homebrew
brew install molmedoz/tap/gopher

# Or upgrade
brew upgrade gopher
```

### **Windows:**
```powershell
# Using Chocolatey
choco install gopher

# Or upgrade
choco upgrade gopher
```

### **Linux:**
```bash
# Using Snap (all distributions)
sudo snap install gopher

# Using APT (Debian/Ubuntu)
curl -fsSL https://molmedoz.github.io/gopher-apt/KEY.gpg | sudo apt-key add -
echo "deb [trusted=yes] https://molmedoz.github.io/gopher-apt /" | sudo tee /etc/apt/sources.list.d/gopher.list
sudo apt update
sudo apt install gopher

# Using DNF/YUM (Fedora/RHEL)
sudo tee /etc/yum.repos.d/gopher.repo <<EOF
[gopher]
name=Gopher Repository
baseurl=https://molmedoz.github.io/gopher-rpm
enabled=1
gpgcheck=0
EOF
sudo dnf install gopher

# Direct download (all platforms)
# See: https://github.com/molmedoz/gopher/releases
```

---

## üìä **Package Distribution Checklist**

### **One-Time Setup:**
- [ ] Create `homebrew-tap` repository
- [ ] Create Chocolatey account and reserve package
- [ ] Create Snapcraft account
- [ ] Add `.goreleaser.yml` to repository
- [ ] Add `.github/workflows/release.yml`
- [ ] Configure GitHub secrets (tokens/API keys)
- [ ] Test with snapshot release

### **Each Release:**
- [ ] Update CHANGELOG.md
- [ ] Run tests
- [ ] Create and push tag
- [ ] Verify GitHub Actions workflow
- [ ] Check GitHub Release
- [ ] Verify package manager updates
- [ ] Announce release

---

## üéì **Resources**

- **GoReleaser:** https://goreleaser.com/
- **Homebrew:** https://docs.brew.sh/
- **Chocolatey:** https://docs.chocolatey.org/
- **Snapcraft:** https://snapcraft.io/docs
- **GitHub Actions:** https://docs.github.com/en/actions

---

## ‚úÖ **Quick Start Summary**

1. **Install GoReleaser**: `brew install goreleaser`
2. **Add `.goreleaser.yml`** (use config above)
3. **Create `homebrew-tap` repository**
4. **Set up accounts** (Chocolatey, Snapcraft)
5. **Add GitHub Actions workflow**
6. **Configure secrets**
7. **Create tag**: `git tag -a v1.0.0 -m "Release"`
8. **Push tag**: `git push origin v1.0.0`
9. **Watch automation work!** ‚ú®

---

**Last Updated:** 2025-10-13  
**Next Step:** Set up GoReleaser and create your first automated release!

